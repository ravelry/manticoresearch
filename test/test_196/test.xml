<?xml version="1.0" encoding="utf-8"?>
<test>

<name>wordforms: comments, after morph modifier, multiple wordform files</name>

<config>
indexer
{
	mem_limit			= 16M
}

searchd
{
	<searchd_settings/>
	workers = threads
}

source test
{
	type				= mysql
	<sql_settings/>
	sql_query			= select * from test_table
}

index test
{
	source				= test
	path				= <data_path/>/test
	wordforms			= <this_test/>/wordforms.txt
	wordforms			= <this_test/>/words*.txt
	morphology			= stem_en
}

index ord1
{
	source				= test
	path				= <data_path/>/ord1
	wordforms			= <this_test/>/wf1.txt
}

index ord2
{
	source				= test
	path				= <data_path/>/ord2
	wordforms			= <this_test/>/wf2.txt
}

source test1
{
	type				= mysql
	<sql_settings/>
	sql_query			= select *, 11 as gid from test_table1
	sql_attr_uint		= gid
}

index idx_pre1
{
	source				= test1
	path				= <data_path/>/idx_pre1
	index_exact_words   = 1	
	min_prefix_len 		= 1
}

index idx_pre2 : idx_pre1
{
	path				= <data_path/>/idx_pre2
	wordforms			= <this_test/>/wf_pre.txt
}

</config>

<db_create>
CREATE TABLE test_table
(
	id INTEGER PRIMARY KEY NOT NULL,
	content VARCHAR(255) NOT NULL
);
</db_create>
<db_drop>DROP TABLE IF EXISTS test_table;</db_drop>
<db_insert>
INSERT INTO test_table VALUES
( 100, 'drink drive' ),
( 101, 'smoked flew' ),
( 102, 'simple form' ),
( 103, 'manuscript' ),
( 104, 'before after' ),
( 105, 'me walked' ),
( 106, 'us walk' ),
( 107, 'me run' ),
( 108, 'us running' ),
( 111, 'tell me test fest but not test pest' ),
( 120, 'wound care and ostomy' )
</db_insert>

<db_create>
CREATE TABLE test_table1
(
	id INTEGER PRIMARY KEY NOT NULL,
	content VARCHAR(255) NOT NULL
);
</db_create>
<db_drop>DROP TABLE IF EXISTS test_table1</db_drop>
<db_insert>INSERT INTO test_table1 VALUES ( 100, 'forty' ), ( 101, 'fortyfour' )</db_insert>

<sphqueries>
<sphinxql>select * from test where match('multi_before')</sphinxql>
<sphinxql>select * from test where match('wordform')</sphinxql>
<sphinxql>select * from test where match('result1')</sphinxql>
<sphinxql>select * from test where match('result2')</sphinxql>
<sphinxql>select * from test where match('book1')</sphinxql>
<sphinxql>select * from test where match('book2')</sphinxql>
<sphinxql>select * from test where match('shouldnotbe')</sphinxql>
<sphinxql>select * from test where match('ran')</sphinxql>
<sphinxql>select * from test where match('halt')</sphinxql>
<!-- regression crash on wordform with multiple destination tokens -->
<sphinxql>select * from test where match('test test')</sphinxql>
<sphinxql>select * from test where match('test pest')</sphinxql>
<!-- regression for multiforms applied in the wrong order -->
<sphinxql>select * from ord1 where match('^wound$')</sphinxql>
<sphinxql>select * from ord2 where match('^wound$')</sphinxql>

<!-- regression prefix matches no wordform only index -->
<sphinxql>select id from idx_pre1 where match('forty*') order by id asc</sphinxql>
<sphinxql>select id from idx_pre2 where match('forty*') order by id asc</sphinxql>
</sphqueries>

</test>